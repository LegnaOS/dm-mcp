# 技能

## 介绍

技能组件

```
local 技能配置 =
{
	类型 = "技能",
	名称 = "普通攻击",
	显示名 = "普通攻击",
	攻击距离 = 1,
	动作 = "攻击",
	间隔 = 2000,
	目标阵营 = "敌方",		-- 友方 敌方 不限
	目标位置 = 0,		 -- 0 角色目标 1 鼠标地图格子 2 优先角色目标再选鼠标地图格子 3 自身
	优先级 = 1, 			-- 值越大越优先使用
	伤害延迟 = 500,
	伤害范围 = {类型=1,范围={{0,0,100}}},
	受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(255,255,255,255)},
	伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2)", -- a 我方 b 敌方
}
return 技能配置

```

## 配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| 类型 | 文本 | true | | 固定值： 技能 表示这是一个技能组件 |
| 名称 | 文本 | true | | 全局唯一的技能标识，如果发生重复旧技能会被覆盖 |
| 显示名 | 文本 | true | | 技能用于描述的名称 |
| 气泡提示 | 文本 | false | | |
| 图标 | 文本 | false | | |
| 等级 | 整数 | false | | |
| 伤害系数 | 小数 | false | | |
| 目标阵营 | 文本 | false | | 敌方 友方 不限 |
| 攻击距离 | 整数 | false | | 技能的攻击距离 单位：格子 |
| 最小距离 | 整数 | false | | 与目标之间最短距离 单位：格子 默认：0 |
| 动作 | 文本/nil | false | | |
| hp | 整数 | false | | 每次释放消耗的hp值 |
| mp | 整数 | false | | 每次释放消耗的mp值 |
| 怒气 | 整数 | false | | 每次释放消耗的怒气值 |
| 仇恨 | 整数 | false | | 释放后自身增加多少仇恨 默认：0 |
| 间隔 | 整数 | false | | 技能CD |
| 目标位置 | 整数 | false | | 0 角色目标 1 鼠标地图格子 2 优先角色目标再选鼠标地图格子 3 主角 |
| 优先级 | 数值 | false | | 拥有多个自动释放的技能时，释放优先级越大越优先使用 -1 为禁用 |
| 伤害延迟 | 数值 | false | | 单位毫秒 |
| 自动结束 | 逻辑 | false | | 释放时,自动结束掉之前释放的所有同类技能 |
| 绝对命中 | 逻辑 | false | | 不受角色命中属性影响,百分百命中。默认：false |
| 绝对暴击 | 逻辑 | false | | 不受角色暴击属性影响,百分百暴击。默认：false |
| 起手方向 | 整数 | false | | `0：系统自动` `1：鼠标方向` `2: 不变化` 默认：0 |
| 起手效果 | table {} | false | | 技能启动后的效果 |
| 命中效果 | table {} | false | | 技能命中后的效果 |
| 受伤效果 | table | false | | 技能命中目标后，目标的受伤效果 |
| 掉血效果 | table | false | | 命中目标后，可以覆盖目标角色配置项中的掉血效果 |
| 伤害范围 | table | false | 支持 | 技能的伤害范围 |
| 伤害公式 | 文本/function | false | | 技能的伤害公式 |
| 命中范围 | table | false | 支持 | 技能的命中范围 |
| 命中提示 | table | false | | 技能可释放前显示伤害范围预警效果 |
| 格子效果 | table {} | false | | |
| 附加 | table | false | | 模板变量的数据源 |
| 资源表 | table | false | | { {标识="",文件=""}, {标识="",文件=""}, .. } |

### 动作

- 当角色外观是动画模式时 例动作 = "施法,1,1,0"填写文本型动作名称时,格式:动作名,播放次数,播放模式,定格帧除动作名外其他都可省略,默认值为:攻击播放次数: 默认值为1,填0表示循环重复播放。播放模式: 默认值为0正序播放,填1表示倒序播放。定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。填写nil表示此技能不播放起手动作,允许移动中释放
- 填写文本型动作名称时,格式:动作名,播放次数,播放模式,定格帧除动作名外其他都可省略,默认值为:攻击播放次数: 默认值为1,填0表示循环重复播放。播放模式: 默认值为0正序播放,填1表示倒序播放。定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。
- 播放次数: 默认值为1,填0表示循环重复播放。
- 播放模式: 默认值为0正序播放,填1表示倒序播放。
- 定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。
- 填写nil表示此技能不播放起手动作,允许移动中释放
- 当前角色外观是图片模式时 动作名设置攻击施法动画效果不同

当角色外观是动画模式时 例动作 = "施法,1,1,0"

- 填写文本型动作名称时,格式:动作名,播放次数,播放模式,定格帧除动作名外其他都可省略,默认值为:攻击播放次数: 默认值为1,填0表示循环重复播放。播放模式: 默认值为0正序播放,填1表示倒序播放。定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。
- 播放次数: 默认值为1,填0表示循环重复播放。
- 播放模式: 默认值为0正序播放,填1表示倒序播放。
- 定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。
- 填写nil表示此技能不播放起手动作,允许移动中释放

- 播放次数: 默认值为1,填0表示循环重复播放。
- 播放模式: 默认值为0正序播放,填1表示倒序播放。
- 定格帧表示在播放动作时，是否不播放完整动画而是定格在某一帧。

当前角色外观是图片模式时 动作名设置攻击施法动画效果不同

### 目标位置

| 位置 | 说明 |
| --- | --- |
| `0` | 当前有目标就对目标发动技能，没有目标就对鼠标当前焦点的角色发动技能。 |
| `1` | 在鼠标当前地图格子位置发动技能 |
| `2` | 在鼠标位置发动技能，如果鼠标有角色焦点会锁定角色。 |
| `3` | 对释放人发动技能 |

### 优先级

- 当角色拥有多个技能，并且都打开了自动释放时，可以通过优先级控制释放节奏。
- 数值越大的越先释放。
- -1 表示关闭这个技能，不自动释放。
- 如果一个技能的优先级高，并且间隔短，那么这个技能会一直优先。

### 受伤效果

技能命中目标后，可以配置目标的受伤效果。

```
受伤效果 = {几率=100,动作=true,音效=true,命中音效=true,闪烁=RGBA(255,255,255,255)},

```

| 名称 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `几率` | 数值 | true | 触发受伤动作，音效的几率 |
| `动作` | 逻辑 | true | 目标角色动画有 `受伤` 动作时有效 |
| `音效` | 逻辑 | true | 目标角色动画有 `受伤` 音效时有效 |
| `闪烁` | RGBA | true | 目标角色是否进行一次闪烁，不闪烁填0 |
| `命中音效` | 逻辑 | false | 是否播放伤害来源角色中配置的命中音效 |

### 伤害公式

a:我方 b:敌方 c:技能对象，公式中可以使用lua math相关的方法，运算结果即为伤害

```
伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2) * c.伤害系数",

```

```
伤害公式 = "60", -- 可以直接给出具体数字

```

支持两种返回值

- 1.返回数值型伤害结果
- 2.返回table可以控制飘血效果 ：{掉血值,掉血数字颜色,掉血数字缩放,掉血数字效果}

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 技能对象 | 技能对象 | |
| 来源角色 | 角色对象 | 技能发起方 |
| 目标角色 | 角色对象 | 技能目标方 |
| 伤害比例 | 小数 | |
| 名称 | 文本 | 当前阶段的效果名称,非效果触发时为技能名 |

## 示例

```
local 伤害计算 = function (技能对象,来源角色,目标角色,伤害比例,名称)
	if (名称 == "二阶子弹") then
		return {20,RGBA(255,255,0,255),1.3,3} -- 改变飘血效果
	end
	return 50
end

伤害公式 = function (技能对象,来源角色,目标角色,伤害比例,名称)
 引擎.弹出文字(目标角色.x,目标角色.y - 目标角色.角色高度 * 0.5,tostring(4) ,"艺术字",目标角色.地图,{颜色=RGBA(0,255,0,255),动效=3});
 引擎.弹出文字(目标角色.x,目标角色.y - 目标角色.角色高度 * 0.5,tostring(4) ,"艺术字",目标角色.地图,{颜色=RGBA(140,200,250,255),延迟=100,动效=3});
 return 8
end,

```

### 命中起手效果

技能起手后开始触发起手效果，技能命中后开始触发命中效果。

效果配置项是一个table数组，里面可以配置音效，动画效果。可以丰富游戏细节。

```
起手效果 = {
 {延迟=0,音效={"血影刀法起手音效"}},
 {延迟=0,动画="血影刀法,攻击"},
 {延迟=400,子弹 = {
 形态="动画,火球术,飞行",
 速度 = 800,
 射程 = 1200,
 数量 = 1,
 角度 = 0,
 间隔 = 0,
 动效 = 0,	-- 0 直线 1 抛物线
 穿透 = 0,
 伤害延迟 = 0,
 伤害范围 = {类型=1,范围={{0,0,100}}},
 光影效果 = {锚点x=0.5,锚点y=0.5,水平缩放=1.0,垂直缩放=1.0,颜色=RGBA(255, 255, 0,255)},
 伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2)", -- a 我方 b 敌方
 受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(255,255,0,255)},
 命中效果 = {{延迟=0,音效={"小火球结束"}},{延迟=0,动画="火球术,命中"}},
 }
 },
},
命中效果 = {
 {延迟=200,音效={"雷电术_结束"}},
 {延迟=200,动画="雷电术,命中"}
}

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `音效` | table {} | true | | 随机播放其中一个音效 `{音效1,音效2,音效3,...}` |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

```
{延迟=0,音效={"梅花镖命中"}},

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `动画` | 文本 | true | | 动画资源标识 动画标识语法： `动画,动作,缩放,速度,位置` 其中缩放,速度,位置可以不写 `位置` 设置为 `1` 且有角色被命中,播放点是角色中心，例： `"奔雷动画,命中,1,1,1"` |
| `图层` | 整数 | false | | `0` :地图地表层 `1` :地图顶层 `2` :地图物件层[排序] `3` :角色顶层[跟随] 默认：1 |
| `x` | 整数 | false | | 显示偏移x坐标 |
| `y` | 整数 | false | | 显示偏移y坐标 |
| `位置` | 整数 | false | | `0` :在命中点播放 `1` :在伤害点播放 默认：0 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

```
{延迟=0,动画="火球术,命中"},

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `子弹` | table {} | true | | 配置项详见下表 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- 子弹配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `形态` | 文本 | true | 支持 | 动画写法： `动画,动画标识,动作,缩放,角度校正` 图片写法： `图片,图片标识,缩放,角度校正` |
| `速度` | 整数 | false | 支持 | 子弹的移动速度 |
| `射程` | 整数 | false | 支持 | 子弹的最远射程 动效 `0` 时,设置负射程,子弹会按 `角度` 从空中飞出 |
| `数量` | 整数 | false | 支持 | 发射几颗子弹 |
| `连发模式` | 整数 | false | | `数量` > 1时有效 `0` 黄金分割 `1` 顺时针 `2` 逆时针 |
| `间隔` | 整数 | false | | 每颗子弹的发射间隔 |
| `动效` | 整数 | false | | `0` 直线 `1` 抛物线 `2` S曲线 `3` 环绕 `4` 飞剑 |
| `角度` | 整数 | false | 支持 | 总的发射角度 |
| `加速度` | 整数 | false | | 产生加速效果 默认 `0` |
| `穿透` | 整数 | false | 支持 | 子弹的穿透次数 默认 `0` 飞剑模式下次数用完,子弹消失 |
| `持续时间` | 整数 | false | 支持 | 环绕子弹,飞剑型子弹有效 默认 `0` 表示无限时间 |
| `定时触发` | 整数 | false | 支持 | `3` 环绕型子弹此配置可以按定时间隔自动触发 `命中效果` `4` 飞剑型子弹此配置可以控制攻击频率 单位：毫秒 |
| `起点坐标` | table {x,y} | false | 支持 | 手动指定子弹起点地图坐标 `起点坐标={x=1000,y=1000}` |
| `目标坐标` | table {x,y} | false | 支持 | 手动指定子弹终点地图坐标 `目标坐标={x=1000,y=1000}` |
| `自动旋转` | 逻辑 | false | | 子弹是否自动根据目标变换角度 默认 `true` |
| `自动追踪` | 逻辑 | false | | 在技能攻击距离内,寻找指定数量的目标 |
| `追踪距离` | 整数 | false | | 与 `自动追踪` 配套使用 |
| `伤害延迟` | 整数 | false | | 命中后多少毫秒才出现伤害 |
| `伤害范围` | table | false | 支持 | 同 伤害范围 |
| `伤害公式` | table | false | | 同 伤害公式 |
| `受伤效果` | table | false | | 同 受伤效果 |
| `命中提示` | table | false | | 同 命中提示 |
| `命中范围` | table | false | 支持 | 同 命中范围 每一个命中点都会产生一个技能对象 |
| `命中效果` | table | false | | 同 技能效果 可无限嵌套 |
| `光影效果` | table | false | | 同 光影效果 |
| `掉血效果` | table | false | | 同 掉血效果 |
| `阴影比例` | table | false | | {水平比例,垂直比例} 默认：{0.8,0.8} 不显示影子设置为：{0,0} |
| `名称` | 文本 | false | 支持 | 会传递到函数形式的 `伤害公式` 参数中 |

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `闪电链` | table {} | true | | 配置项详见下表 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- 闪电链配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `宽度` | 数值 | true | 支持 | 默认：2.5 |
| `颜色` | RGBA | true | 支持 | 默认：RGBA(100, 180, 255,255) |
| `光晕色` | RGBA | false | 支持 | 默认：RGBA(100, 180, 255,80) |
| `渐入` | 整数 | false | | 闪电链渐隐渐入效果 默认：200 |
| `渐出` | 整数 | false | | 闪电链渐隐渐入效果 默认：200 |
| `节点数量` | 整数 | false | 支持 | 一条闪电链分成多少段 默认：30 |
| `抖动幅度` | 整数 | false | | 数值越大越剧烈 默认：100 |
| `持续时间` | 整数 | false | 支持 | > 0表示持续型闪电链 |
| `伤害间隔` | 整数 | false | 支持 | 默认：1000 |
| `末端变细` | 逻辑 | false | | 默认：true |
| `自动追踪` | 逻辑 | false | | 在技能攻击距离内,寻找指定数量的目标 |
| `追踪距离` | 整数 | false | 支持 | 与 `自动追踪` 配套使用 |
| `数量` | 整数 | false | 支持 | 自动追踪时发射几条闪电链 |
| `起点坐标` | table {x,y} | false | 支持 | 手动指定闪电链起点地图坐标 `起点坐标={x=1000,y=1000}` |
| `伤害延迟` | 整数 | false | | 命中后多少毫秒才出现伤害 |
| `伤害范围` | table | false | | 同 伤害范围 |
| `伤害公式` | table | false | | 同 伤害公式 |
| `受伤效果` | table | false | | 同 受伤效果 |
| `命中效果` | table | false | | 同 技能效果 可无限嵌套 |
| `掉血效果` | table | false | | 同 掉血效果 |
| `光影效果` | table | false | | 同 光影效果 |
| `跟随` | 逻辑 | false | | 起点是否绑定施法者,或者命中的角色对象,跟角色位置自动变化 |
| `名称` | 文本 | false | 支持 | 会传递到函数形式的 `伤害公式` 参数中 |

```
{延迟= 0,闪电链={
 宽度 = 1.6,
 持续时间 = 0,
 伤害间隔 = 200,
 自动追踪 = true,
 追踪距离 = 8,
 数量 = 8,
 渐入 = 300,
 渐出 = 500,
 伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2)",
 受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(220,220,220,255)},
 命中效果 = {

 }

}},

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `地面伤害` | table {} | true | | 配置项详见下表 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- 地面伤害配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `持续动画` | 文本 | true | 支持 | 动画资源标识 动画标识语法： `动画,动作,缩放,速度` 其中缩放和速度可以不写 |
| `持续时间` | 数值 | true | 支持 | 单位：毫秒 |
| `伤害间隔` | 数值 | true | 支持 | 单位：毫秒 设置： `-1` 时,表示只触发一次 `命中效果` |
| `定时触发` | 逻辑 | false | | 默认：false 开启后无需命中目标,按照 `伤害间隔` 定时触发 `命中效果` |
| `伤害范围` | table | false | 支持 | 同 伤害范围 |
| `伤害公式` | table | false | | 同 伤害公式 |
| `受伤效果` | table | false | | 同 受伤效果 |
| `命中效果` | table | false | | 同 技能效果 可无限嵌套 |
| `命中范围` | table | false | 支持 | 同 命中范围 每一个命中点都会产生一个技能对象 |
| `开始动作` | 文本 | false | | 设置地面动画开始动作 增强细节 |
| `结束动作` | 文本 | false | | 设置地面动画结束作 增强细节 |
| `移动速度` | 整数 | false | 支持 | 地图伤害是否可移动 默认：0 |
| `移动角度` | 整数 | false | 支持 | 移动时的角度偏移 默认：0 |
| `自动追踪` | 逻辑 | false | | 是否自动寻找,跟踪敌方目标 |
| `追踪距离` | 整数 | false | 支持 | 与 `自动追踪` 配套使用 |
| `光影效果` | table | false | | 同 光影效果 |
| `掉血效果` | table | false | | 同 掉血效果 |
| `排序` | 逻辑 | false | | 地面动画是否参与地图遮挡排序 |
| `障碍` | 逻辑 | false | | 效果是否改变地图格子通行状态 |
| `跟随` | 逻辑 | false | | 效果是否绑定施法者,跟随施法者位置自动变化 |
| `状态同步` | 文本 | false | | 填写一个状态名称,如果施法者没有该状态,此效果消失 |
| `地图碰撞` | 整数 | false | 支持 | 移动时遇到地图障碍时 `0:停止` , `1:反向` , `2:穿透` 默认：0 |
| `名称` | 文本 | false | 支持 | 会传递到函数形式的 `伤害公式` 参数中 |

```
{延迟=0,地面伤害={
 持续动画 = "火墙,持续",
 持续时间 = 30000,
 伤害间隔 = 1500,
 伤害范围 = {类型=1,范围={{0,0,100}}},
 受伤效果 = {几率=100,动作=false,音效=true,闪烁=RGBA(255,255,0,255)},
 伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2)",
 命中范围 = {
 {0,0},	-- 7 0 1
 {0,1},	-- 6 x 2
 {4,1}, -- 5 4 3
 {2,1},
 {6,1}
 },
 命中效果 = {
 {延迟=0,音效={"小火球结束"}},
 {延迟=0,动画="火球术,命中"},
 {延迟=0,光影={
 颜色=RGBA(255, 255, 0,255),
 缓动={{时间=300,水平缩放=2.0,垂直缩放=2.0,透明度=0.6},{时间=500,透明度=0}}
 }},
 {延迟=0,子弹 = {
 形态="动画,火球术,飞行",
 速度 = 600,
 射程 = 1200,
 数量 = 8,
 角度 = 0,
 间隔 = 0,
 加速度 = 0,
 持续时间 = 30000,
 动效 = 1,	-- 0 直线 1 抛物线 2 S曲线 3 环绕
 自动追踪 = true,
 穿透 = 0,
 伤害延迟 = 0,
 伤害范围 = {类型=1,范围={{0,0,100}}},
 伤害公式 = "a.攻击 ^ 2 / ( a.攻击 + b.防御 ) * (0.8 + math.random()*0.2)",
 受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(255,255,0,255)},
 光影效果 = {锚点x=0.5,锚点y=0.5,水平缩放=0.8,垂直缩放=0.8,颜色=RGBA(255, 255, 0,255)},
 }}

 },
}},

{延迟=300,
 地面伤害={
 持续动画 = "龙卷风动画,小",
 持续时间 = 18000,
 伤害间隔 = 500,
 移动速度 = 100,
 移动角度 = -60,
 伤害公式 = "math.random(10)",
 伤害范围 = {类型=1,范围={{0,0,100}}},
 }
},

```

冲锋效果只在起手效果中有效

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `冲锋` | table {} | true | | 配置项详见下表 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- 冲锋配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `动作` | 文本 | true | | |
| `定格帧` | 整数 | false | | 指定在动作的某一帧停止播放动作 默认：0 |
| `半径` | 数值 | false | 支持 | 像素距离 不填写或者0表示定点冲锋到目标 |
| `速度` | 数值 | false | 支持 | 移动速度 默认：2000 |
| `目标坐标` | table {x,y} | false | 支持 | 手动指定冲锋目标点的地图坐标,无视障碍 `目标坐标={x=1000,y=1000}` |
| `拖尾` | 数值 | false | | 值越小幻影生成越密 推荐：50 默认：0 不显示 |
| `可见` | 逻辑 | false | | 移动时角色是否可见 默认：true |
| `动画` | 文本 | false | | 动画资源标识 动画标识语法： `动画,动作,缩放,速度,位置` 其中缩放,速度,位置可以不写 `位置` 设置为 `1` 播放点是角色中心，例： `"奔雷动画,命中,1,1,1"` |
| `伤害延迟` | 整数 | false | | 命中后多少毫秒才出现伤害 |
| `伤害范围` | table | false | | 同 伤害范围 |
| `伤害公式` | table | false | | 同 伤害公式 |
| `受伤效果` | table | false | | 同 受伤效果 |
| `命中提示` | table | false | | 同 命中提示 |
| `命中效果` | table | false | | 同 技能效果 可无限嵌套 |
| `掉血效果` | table | false | | 同 掉血效果 |

```
{延迟=0,冲锋={
 动作="攻击",
 定格帧=10,
 半径=300,
 速度=3000,
 拖尾 = 10,
 伤害延迟 = 0,
 伤害公式 = "16",
 伤害范围 = {类型=2,范围={{0,1,100}}},
 受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(255,255,255,255)},
 命中效果 = {
 {延迟=0,击退={距离=1,速度=200}},
 },
}}

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `击退` | table {} | true | | 配置项详见下表 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- 击退配置项

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `距离` | 数值 | true | 支持 | 最多击退多少格 默认：1 , 反方向模式下设置 `0` 表示自动设置为目标到命中点的距离 |
| `速度` | 数值 | true | 支持 | 后移速度 默认：200 |
| `反方向` | 逻辑 | false | | 反方向移动 默认：false |
| `方向判定` | 数值 | false | | 0：按命中点计算方向 1：按施法人计算方向 默认：0 |

```
{延迟=0,击退={距离=1,速度=200}},

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `状态` | 文本 / table | true | | 可填写状态组件名称或者完整的状态组件配置项 |
| `属性表` | table | false | 支持 | 同 属性表 功能 |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

```
命中效果 = {
 {延迟=800,状态={
 类型 = "状态",
 名称 = "施毒术_",
 几率 = 100,
 持续时间 = 20000,
 触发间隔 = 2500,	-- 0 只触发一次
 hp = -3,
 受伤效果 = {几率=100,动作=true,音效=true,闪烁=RGBA(0,250,0,255)},
 开始动画 = {{动画="施毒术,命中",跟随=true}},
 开始音效 = {"施毒术_结束"},
 滤镜 = {2,0,0.4,0},
 }},
},

```

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `颜色` | RGBA | true | | |
| `锚点x` | 数值 | false | | 默认 0.5 |
| `锚点y` | 数值 | false | | 默认 0.5 |
| `缓动` | table {} | true | | {时间,水平缩放,垂直缩放,透明度} |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

```
命中效果 = {
 {延迟=800,音效={"雷电术_结束"}},
 {延迟=800,动画="雷电术,命中"},
 {延迟=500,光影={
 颜色=RGBA(255,255,255,255),
 锚点x=0.5,锚点y=0.6,
 缓动={{时间=500,水平缩放=5,垂直缩放=8,透明度=1},{时间=500,透明度=0}}
 }},
 {延迟=500,光影={
 颜色=RGBA(255,255,255,255),
 锚点x=0.5,锚点y=0.5,
 缓动={{时间=500,水平缩放=1.5,垂直缩放=1.5,透明度=1},{时间=500,水平缩放=0,垂直缩放=0,透明度=0}}
 }
},

```

执行自定义函数

| 名称 | 类型 | 必填 | 模板变量 | 说明 |
| --- | --- | --- | --- | --- |
| `延迟` | 数值 | true | 支持 | 单位：毫秒 |
| `Call` | function | true | | |
| `几率` | 数值 | false | 支持 | 百分比：默认 100 |

- Call回调参数说明

| 名称 | 类型 | 说明 |
| --- | --- | --- |
| `来源角色` | 角色对象 | |
| `当前技能` | 技能对象 | 当前释放的技能对象 |
| `命中目标组` | 角色对象 {} | 命中效果中有效 |
| `命中位置` | {x,y,格子x,格子y} | 技能命中时的地图坐标,地图格子 命中效果中有效 |

```
命中效果 = {
 {延迟=500,Call = function(来源角色,当前技能,命中目标组,命中位置)
 来源角色.添加宠物("变异骷髅",1)
 end
 },
},

```

### 伤害范围

当技能命中目标后，系统根据配置的伤害范围进行伤害触发。伤害范围是由一个table数组构成，以格子为单位进行判断。目前有3种类型。

面向：以角色为中心,面朝上为0，顺时针8个方向。0,1,2,3,4,5,6,7。

类型=1 指定面向和距离，精确指定格子。

| 名称 | 类型 | 说明 |
| --- | --- | --- |
| `类型` | 整数 | 1：点模式 2：面模式 3：角度 |
| `范围` | table {} | `{{面向,距离,伤害比例},{面向,距离,伤害比例},{面向,距离,伤害比例},...}` |

| 半月剑法 按面向对周围5个怪物造成伤害 正前方100%伤害 其余70%伤害 `伤害范围 = { 类型 = 1, 范围 = { {0,1,100}, -- 7 0 1 {1,1,70}, -- 6 x 2 {2,1,70}, -- 5 4 3 {6,1,70}, {7,1,70} } }, ` | |
| --- | --- |
| 普攻 当释放位置为0(锁定目标)时 对目标自身造成伤害 `伤害范围 = { 类型 = 1, 范围 = { {0,0,100}, -- 距离 0 } }, ` | |

#### 半月剑法

```
伤害范围 = {
 类型 = 1,
 范围 = {
 {0,1,100},	-- 7 0 1
 {1,1,70},	-- 6 x 2
 {2,1,70}, -- 5 4 3
 {6,1,70},
 {7,1,70}
 }
},

```

#### 普攻

```
伤害范围 = {
 类型 = 1,
 范围 = {
 {0,0,100},	-- 距离 0
 }
},

```

类型=2 以命中点为中心，按距离造成范围伤害。

| 名称 | 类型 | 说明 |
| --- | --- | --- |
| `类型` | 整数 | 1：点模式 2：面模式 3：角度 |
| `范围` | table {} | `{{面向,距离,伤害比例},{面向,距离,伤害比例},{面向,距离,伤害比例},...}` 范围伤害时面向已经无效。 |

```
伤害范围 = {
 类型 = 2,
 范围 = {
 {0,1,100},	-- 第1圈造成100%伤害
 {0,2,150},	-- 第2圈造成150%伤害
 {0,3,200},	-- 第3圈造成200%伤害
 }
},

```

类型=3 以命中点为中心，按角度距离造成范围伤害。

| 名称 | 类型 | 说明 |
| --- | --- | --- |
| `类型` | 整数 | 1：点模式 2：面模式 3：角度 |
| `范围` | table {} | `{{角度,距离,伤害比例},{角度,距离,伤害比例},{角度,距离,伤害比例},...}` |

```
伤害范围 = {
 类型 = 3,
 范围 = {
 {180,3,100},	-- 当前面向角度开合180°角 3格内区域
 }
},

```

提示

当释放位置不同，伤害范围计算的起始点也不同。

### 命中范围

- 设置命中范围可以指定技能对多个不同格子发动命中判断，扩展技能效果自由度。
- 同伤害范围一样的设置区域, 范围成员中多了延迟时间配置，例： { {面向,距离,伤害比例,延迟时间},{面向,距离,伤害比例,延迟时间},... }

| 名称 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `类型` | 整数 | true | 1：点模式 2：面模式 3：角度 |
| `范围` | table {} | true | 同 `伤害范围` 成员中增加了 `延迟时间` |
| `起点` | 整数 | false | `0：以命中点为中心` `1：以施法人为中心` 默认：0 |
| `角色模式` | 逻辑 | false | 仅当命中角色时才触发。默认：false |
| `唯一模式` | 逻辑 | false | 每个目标只发生一次伤害。默认：false |

| 对目标点每隔500毫秒进行一次命中，连续8次 `命中范围 = { 类型 = 1, 范围 = { {0,0,100,0}, {0,0,100,500}, {0,0,100,1000}, {0,0,100,1500}, {0,0,100,2000}, {0,0,100,2500}, {0,0,100,3000}, {0,0,100,3500} } }, ` | |
| --- | --- |
| 在目标点 十字范围 产生5个命中点 `命中范围 = { 类型 = 1, 范围 = { {0,0}, -- 7 0 1 {0,1}, -- 6 x 2 {4,1}, -- 5 4 3 {2,1}, {6,1} } }, ` | |

```
命中范围 = {
 类型 = 1,
 范围 = {
 {0,0,100,0},
 {0,0,100,500},
 {0,0,100,1000},
 {0,0,100,1500},
 {0,0,100,2000},
 {0,0,100,2500},
 {0,0,100,3000},
 {0,0,100,3500}
 }
},

```

```
命中范围 = {
 类型 = 1,
 范围 = {
 {0,0},	-- 7 0 1
 {0,1},	-- 6 x 2
 {4,1}, -- 5 4 3
 {2,1},
 {6,1}
 }
},

```

提示

每次命中都会触发一次伤害，播放一轮命中特效。

### 命中提示

- 技能命中前让地图上出现伤害范围预警。
- 闪烁效果会联动伤害比例,透明度不同。

```
命中提示 = {延迟=400,时间=1000, 颜色=RGBA(255,255,0,255), 边框宽度=8},

```

| 名称 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `延迟` | 数值 | true | 技能释放后多久出现预警 |
| `时间` | 数值 | false | 预警提示持续多少毫秒 |
| `颜色` | RGBA | false | 闪烁的颜色 |
| `边框宽度` | 数值 | false | 预警效果的边框宽度 |

### 格子效果

当技能在格子中的时候，这个配置项可以让显示更加丰富。

| 名称 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `资源名称` | 文本 | true | 动画或者是图片，动画写法同样是：动画,动作,缩放,速度 |
| `拿起显示` | 整数 | false | 鼠标拿起这个道具的时候，鼠标上是否显示这个元素。 `0` 不显示 `1` 显示 |
| `x` | 整数 | false | 显示偏移x 相对格子中心点的偏移坐标 |
| `y` | 整数 | false | 显示偏移y 相对格子中心点的偏移坐标 |

```
格子效果 = {{"技能图标|攻击",1},{"UI_格子点燃图片",0}}

```

## 系统事件

### 🔹 创建

角色增加技能的时候，会触发此事件。

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 来源角色 | 角色对象 | |
| 技能对象 | 技能对象 | |

## 示例

```
系统事件 = {
	创建 = function(来源角色,技能对象)

 调试输出(来源角色.名称 .. " 增加技能 " .. 技能对象.名称)
 技能对象.气泡提示 = 来源角色.名称 .. "的" .. 技能对象.名称

	end
},

```

### 🔹 启动

- 技能启动前触发。
- 返回逻辑型false拦截技能释放
- 返回文本型 动作名称 可以动态改变本次技能起手动作。
- 返回数值型 表示施法时间,此阶段角色无法移动等待技能释放, 如果有第二个文本型返回值系统会作为读条施法动作进行循环播放。例：return 1200,"读条"

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 来源角色 | 角色对象 | |
| 技能对象 | 技能对象 | |
| 目标角色 | 角色对象 | |
| 格子x | 整数 | 目标地图格子 |
| 格子y | 整数 | 目标地图格子 |
| 坐标x | 整数 | 目标地图坐标 |
| 坐标y | 整数 | 目标地图坐标 |

## 示例

```
系统事件 = {
 启动 = function (来源角色,技能对象,目标角色,格子x,格子y,坐标x,坐标y)
 调试输出(格子x,格子y,坐标x,坐标y)
 -- return math.random(0,1) == 0 and "拳打" or "脚踢" -- 改变技能本次起手动作
 return false -- 拦截释放
 end
},

系统事件 = {
 启动 = function (来源角色,技能对象,目标角色,格子x,格子y,坐标x,坐标y)
 引擎.屏幕提示("#W准备释放#G" .. 技能对象.显示名,{x =0,y=-来源角色.角色高度-14,弹簧效果=false,动画效果 = 0,气泡皮肤="透明气泡",停留时间=2000},来源角色)
 return 2000 -- 施法时间
 end
}

```

### 🔹 准备

- 开启自动战斗后,释放技能会触发此事件,可以拦截或者改变技能。
- 返回值逻辑型时 false：拦截技能释放
- 返回值整数型时 表示设置一个延迟触发时间
- 返回值文本型时 返回要替换的技能名称,这个技能角色必须已经学会
- 返回值角色对象型时 表示改变释放目标

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 来源角色 | 角色对象 | |
| 技能对象 | 技能对象 | |
| 目标角色 | 角色对象 | |

## 示例

```
系统事件 = {
 准备 = function (来源角色,技能对象,目标角色)
 if(目标角色.检测状态("治疗术_")) then
 return false
 end

 if (来源角色.hp >= 来源角色.maxhp * 0.7) then -- 低于70%才治疗
 return false
 end

 return 1000 -- 1秒后再检测

 end
},

```

### 🔹 结束

- 技能所有命中效果结束后触发。

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 来源角色 | 角色对象 | |
| 技能对象 | 技能对象 | |

## 示例

```
系统事件 = {
 结束 = function (来源角色,技能对象)
 调试输出("技能结束",来源角色.名称,技能对象.名称)
 end
},

```

### 🔹 技能格子

技能在技能格子快捷格子控件中会触发，返回true可以拦截本次技能触发事件

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 技能对象 | 技能对象 | 绑定角色的技能状态，可修改属性参考 属性表 |
| 格子对象 | 格子对象 | |

## 示例

```
系统事件 = {
 技能格子 = function(技能对象,格子对象) -- 技能格子被按下 是否拦截使用 true

 if (not 技能对象.自动释放) then
 技能对象.优先级 = 1
 技能对象.自动释放 = true
 引擎.屏幕提示("#Y半月弯刀开启",{字体="宋体12",间距=2, 行距=6, 弹簧效果=false})
 else
 技能对象.优先级 = -1
 技能对象.自动释放 = false
 引擎.屏幕提示("半月弯刀关闭",{字体="宋体12",间距=2, 行距=6, 弹簧效果=false})
 end

 return true
 end
},

```
