# 地图框

- 地图框控件会自动显示当前地图组件中配置的小地图图片。
- 地图切换,地图框也会自动更新。

| 名称 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| 类型 | 文本 | true | 固定值： 地图框 表示这是一个地图框控件 |
| 名称 | 文本 | true | 窗口中唯一标识 |
| x | 整数 | false | 默认显示坐标x |
| y | 整数 | false | 默认显示坐标y |
| 宽度 | 整数 | false | |
| 高度 | 整数 | false | |
| 背景色 | RGBA | false | |
| 边框宽度 | 整数 | false | |
| 边框色 | RGBA | false | |
| 视野范围 | 整数 | false | 以主角为中心范围内的角色都会显示在小地图上 |
| 地图缩放 | 数值 | false | 最大值 1.0 |
| 光影效果 | 逻辑 | false | 是否同步地图上的光影效果 |
| 迷雾粒度 | 整数 | false | 地图上的迷雾粒度,值越小,迷雾越密。开启光影效果后有效。建议范围：1-3, 默认：0 不开启。 |
| 公共图标 | table {} | false | {"主角图标","友方图标","中立图标","敌方图标"} |
| 角色图标 | table {k,v} | false | |
| 滚轮缩放 | 逻辑 | false | 是否允许鼠标滚轮缩放 |
| 附加 | table | false | 自定义变量 |

```
local 窗口配置 = {
	类型 = "窗口",
	名称 = "小地图窗口",
	标题 = "小地图",
	x = 200,
	y = 100,
	宽度 = 200,
	高度 = 200,
	置顶 = false,
	可移动 = true,
	可穿透 = false,
	默认可视 = true,
	资源表 = {
		{标识="小地图图标",文件="dmstore_JDVWKKEDuAEIkJt0DVWA"},
	},

	控件 =
	{

		{
			名称 = "属性背景",
			类型 = "地图框",
			x = 8,
			y = 38,
			宽度 = 180,
			高度 = 152,
			背景色 = RGBA(32,32,32,255),
			边框宽度 = 0,
			视野范围 = 20,
			公共图标 = {"小地图图标|小地图_主角","小地图图标|小地图_友方","小地图图标|小地图_中立","小地图图标|小地图_敌方"},
			地图缩放 = 1

		},

	}

}

return 窗口配置

```

## 角色图标

- 按角色名显示独立配置的图标。
- 建议把地图框用到的所有的图标打包合并到一个图集中,批渲染优化。

| 成员 | 类型 | 说明 |
| --- | --- | --- |
| 图标 | 文本 | 图片型资源标识 |

```
角色图标 = {
	金刚人 = {
		图标 = "小地图图标|小地图_Boss"
	},
	...
	...
},

```

## 属性

### 可视

- 类型：逻辑
- 说明：是否显示控件

### 父窗口

- 类型：窗口对象
- 读写：只读
- 说明：控件的父窗口对象

```
调试输出(地图框1.父窗口.名称)

```

### 视野范围

- 类型：数值
- 读写：读写
- 说明：地图框配置项中的视野范围读写。

### 次序

- 类型：数值
- 读写：读写
- 说明：动态改变控件的显示层级，值越大越先显示。

### 附加

- 类型：table
- 读写：读写
- 说明：读写控件的附加信息。

## 方法

### 添加组件

添加组件

说明：往地图框中动态加入自定义组件。

参数名称 值的类型 是否必填 说明描述 组件配置 table true 图层 整数 false `0：迷雾层下` `1：迷雾层上` 默认：0 示例 `地图框.添加组件({`

	名称 = "图标_1",
	类型 = "地图图标",
	标题 = "宝藏",
	x = 34 * 64,
	y = 106 * 32
})

| 返回值 | 值的类型 | 说明描述 |
| --- | --- | --- |
| 组件对象 | 对象 | 返回新加入的组件对象 |

| 参数名称 | 值的类型 | 是否必填 | 说明描述 |
| --- | --- | --- | --- |
| 组件配置 | table | true | |
| 图层 | 整数 | false | `0：迷雾层下` `1：迷雾层上` 默认：0 |

## 示例

```
地图框.添加组件({
	名称 = "图标_1",
	类型 = "地图图标",
	标题 = "宝藏",
	x = 34 * 64,
	y = 106 * 32
})

```

| 返回值 | 值的类型 | 说明描述 |
| --- | --- | --- |
| 组件对象 | 对象 | 返回新加入的组件对象 |

### 删除组件

删除组件

说明：根据组件名称进行删除。

参数名称 值的类型 是否必填 说明描述 组件名称 文本 true 示例 `地图框.删除组件("图标_1")`

| 参数名称 | 值的类型 | 是否必填 | 说明描述 |
| --- | --- | --- | --- |
| 组件名称 | 文本 | true | |

## 示例

```
地图框.删除组件("图标_1")

```

### 取出组件

取出组件

说明：取出地图框中的组件对象。

参数名称 值的类型 是否必填 说明描述 组件名称 文本/nil false 不填表示取出所有组件 示例 `local 地图框 = 引擎.窗口.地图窗口.地图框`

local 组件对象 = 地图框.取出组件("图标_2")
组件对象.可视 = false

| 返回值 | 值的类型 | 说明描述 |
| --- | --- | --- |
| 项目对象 | 对象 / 对象 {} / nil | 取出失败返回 nil |

| 参数名称 | 值的类型 | 是否必填 | 说明描述 |
| --- | --- | --- | --- |
| 组件名称 | 文本/nil | false | 不填表示取出所有组件 |

## 示例

```
local 地图框 = 引擎.窗口.地图窗口.地图框
local 组件对象 = 地图框.取出组件("图标_2")
组件对象.可视 = false

```

| 返回值 | 值的类型 | 说明描述 |
| --- | --- | --- |
| 项目对象 | 对象 / 对象 {} / nil | 取出失败返回 nil |

## 系统事件

### 🔹 点击

小地图被点击时触发

| 回调参数 | 类型 | 说明描述 |
| --- | --- | --- |
| 地图框 | 地图框对象 | |
| 地图格子 | {x,y} | 对应地图鼠标格子 |
| 地图坐标 | {x,y} | 对应地图鼠标坐标 |
| 键值 | 整数 | 0：左键 1：右键 2：中键。 |
| 功能键 | 整数 | `1：Ctrl` `2：Shift` `3：Alt` 是否处于按下状态 |

## 示例

```
系统事件 = {
	点击 = function (地图框,地图格子,地图坐标,键值,功能键)
		调试输出(地图格子,地图坐标)
		引擎.地图.镜头对象 = 地图坐标
	end,
}

```
